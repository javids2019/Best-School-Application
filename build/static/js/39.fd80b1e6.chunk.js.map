{"version":3,"sources":["MyApp/auth/login.js","MyApp/auth/userService.js"],"names":["Login","_useState","useState","_useState2","Object","C_MyData_FireBaseGoogle_mybestschool_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","email","setEmail","_useState3","_useState4","password","setPassword","_useState5","_useState6","message","setMessage","useEffect","firebase","auth","signOut","UserService","logout","resetInput","react__WEBPACK_IMPORTED_MODULE_1___default","a","createElement","_hoc_Aux__WEBPACK_IMPORTED_MODULE_8__","className","type","placeholder","value","onChange","e","target","onClick","signInWithEmailAndPassword","toLowerCase","then","currentUser","undefined","user","firestore","collection","where","get","querySnapshot","forEach","doc","userData","data","login","name","role","window","location","href","catch","error","console","log","err","code","react_router_dom__WEBPACK_IMPORTED_MODULE_4__","to","__webpack_require__","d","__webpack_exports__","_firebase__WEBPACK_IMPORTED_MODULE_0__","uuid__WEBPACK_IMPORTED_MODULE_1__","localStorage","setItem","JSON","stringify","this","addLoginHistory","userDetail","getCurrentUser","removeItem","parse","getItem","getDisplayName","getCurrentRole","getIsCurrentAdminRole","pageNewItem","id","uuidv4","loginAt","FieldValue","serverTimestamp","lastUpdate","set"],"mappings":"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","file":"static/js/39.fd80b1e6.chunk.js","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport firebase from \"../../firebase\";\nimport './../../assets/scss/style.scss';\nimport { NavLink, } from 'react-router-dom';\nimport { getAuth, getRedirectResult, GoogleAuthProvider } from \"firebase/auth\";\nimport { AuthContext } from '../auth/auth';\nimport { UserService } from '../auth/userService';\nimport { useHistory } from 'react-router';\nimport Aux from \"../../hoc/_Aux\";\n\nconst Login = () => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n\n  useEffect(() => {\n    firebase.auth().signOut();\n    UserService.logout();\n  }, []);\n\n  const login = () => {\n    firebase\n      .auth()\n      .signInWithEmailAndPassword(email.toLowerCase(), password)\n      .then((currentUser) => {\n        resetInput();\n        if (currentUser.user != undefined && currentUser.user != null) {\n\n            firebase.firestore().collection('users').where(\"email\", \"==\", email.toLowerCase())\n            .get()\n            .then((querySnapshot) => {\n                querySnapshot.forEach((doc) => { \n                    let userData = doc.data()\n                    UserService.login(userData.name, userData.email.toLowerCase(), userData.role);\n                    window.location.href = '/user/userdashboard';\n                });\n            })\n            .catch((error) => {\n                setMessage(error.message);\n                console.log(\"Error getting documents: \", error);\n            }); \n         }\n      })\n      .catch((err) => {\n        if(err.code === 'auth/user-not-found') {\n          setMessage('No record found, Kindly Sign up');\n        } else {\n          setMessage(err.message);\n        }\n        console.error(err);\n      });\n  };\n\n  const logOut = () => {\n    firebase.auth().signOut();\n    UserService.logout();\n  };\n\n  const resetInput = () => {\n    setEmail(\"\");\n    setPassword(\"\");\n  };\n\n  return (\n    <Aux>\n\n      <div className=\"auth-wrapper\">\n        <div className=\"auth-content\">\n          <div className=\"auth-bg\">\n            <span className=\"r\" />\n            <span className=\"r s\" />\n            <span className=\"r s\" />\n            <span className=\"r\" />\n          </div>\n          <div className=\"card\">\n            <div className=\"card-body text-center\">\n              <div className=\"mb-4\">\n                <i className=\"feather icon-unlock auth-icon\" />\n              </div>\n              <h3 className=\"mb-4\">Login</h3>\n              <div className=\"input-group mb-3\">\n                <input type=\"email\" className=\"form-control\" placeholder=\"Email\" value={email} onChange={(e) => setEmail(e.target.value)} />\n              </div>\n              <div className=\"input-group mb-4\">\n                <input type=\"password\" className=\"form-control\" placeholder=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} />\n              </div>\n              <div className=\"form-group text-center\">\n              <label className=\"text-danger\">{message}</label>\n             </div>\n              <button className=\"btn btn-primary shadow-2 mb-4\" onClick={login}>Login</button>\n              {/* <p className=\"mb-2 text-muted\">Forgot password? <NavLink to=\"/auth/reset-password-1\">Reset</NavLink></p> */}\n              <p className=\"mb-0 text-muted\">Donâ€™t have an account? <NavLink to=\"/auth/register\">Signup</NavLink></p>\n            </div>\n          </div>\n        </div>\n      </div> \n    </Aux>\n  );\n};\n\nexport default Login;\n\n\n\n\n    // var provider = new firebase.auth.GoogleAuthProvider();\n    // provider.addScope('profile');\n    // provider.addScope('email');\n    // //provider.addScope('https://www.googleapis.com/auth/contacts.readonly');\n    // firebase.auth().signInWithPopup(provider).then(function (result) {\n    //   // This gives you a Google Access Token. You can use it to access the Google API.\n    //   var token = result.credential.accessToken;\n    //   // The signed-in user info.\n    //   var user = result.user;\n    //   // [START_EXCLUDE]\n    //   document.getElementById('quickstart-oauthtoken').textContent = token;\n    //   // [END_EXCLUDE]\n    // }).catch(function (error) {\n    //   // Handle Errors here.\n    //   var errorCode = error.code;\n    //   var errorMessage = error.message;\n    //   // The email of the user's account used.\n    //   var email = error.email;\n    //   // The firebase.auth.AuthCredential type that was used.\n    //   var credential = error.credential;\n    //   // [START_EXCLUDE]\n    //   if (errorCode === 'auth/account-exists-with-different-credential') {\n    //     alert('You have already signed up with a different auth provider for that email.');\n    //     // If you are using multiple auth providers on your app you should handle linking\n    //     // the user's accounts here.\n    //   } else {\n    //     console.error(error);\n    //   }\n    //   // [END_EXCLUDE]\n    // });\n\n\n"," \nimport firebase from \"../../firebase\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport const UserService = {\n    login,\n    logout,\n    getCurrentUser,\n    getDisplayName,\n    getCurrentRole,\n    getIsCurrentAdminRole,\n    addLoginHistory\n};\n \nfunction login(name, email, role) { \n    //user.authdata = window.btoa(username + ':' + password);\n    localStorage.setItem('user', JSON.stringify({name: name, email: email, role : role }));\n    this.addLoginHistory(name, email, 'LogIn');\n } \n \n function logout() {\n    // remove user from local storage to log user out\n    const userDetail = this.getCurrentUser();\n    if(userDetail) {\n        this.addLoginHistory(userDetail.name, userDetail.email, 'LogOut');\n    }    \n    localStorage.removeItem('user');    \n}\n\nfunction getCurrentUser() {\n    let user = JSON.parse(localStorage.getItem('user'));\n    return user;\n}\n\nfunction getCurrentRole() {\n    let user = JSON.parse(localStorage.getItem('user'));\n    return user != null ? user.role : \"\" ;\n}\n\nfunction getIsCurrentAdminRole(role) {\n    let user = JSON.parse(localStorage.getItem('user'));\n    return user && user.role == role;\n}\n\nfunction getDisplayName() {\n    let user = JSON.parse(localStorage.getItem('user'));\n    return user != null ? user.name : \"\" ;\n}\n\nfunction addLoginHistory(name, email, type) {\n    const pageNewItem = {\n        id: uuidv4(),\n        name,       \n        email,\n        type,\n        loginAt: firebase.firestore.FieldValue.serverTimestamp(),\n        lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),\n    };\n     \n    firebase.firestore().collection('loginhistory').doc(pageNewItem.id)\n        .set(pageNewItem)\n        .catch((err) => {\n            console.error(err);\n        }); \n}\n\n "],"sourceRoot":""}